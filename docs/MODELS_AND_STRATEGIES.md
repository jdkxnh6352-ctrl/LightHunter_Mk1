# LightHunter 模型与策略说明（Mk4 草稿）

> 重点：A 股超短线主战任务 + U1/U2/U3 策略组合  
> 本文接受随时间演进不断修订，以“始终反映当前主战形态”为目标。

---

## 1. 任务与标签

### 1.1 超短主任务（ULTRA）

- **目标**：预测未来 1–3 日内的强势程度，以支持打板/半路/隔日等玩法。
- **常用标签**（在 `config/label_spec.json` 中定义）：
  - `ret_1d`, `ret_2d`, `ret_3d`：收盘对收盘收益；
  - `max_ret_3d`, `min_ret_3d`：未来 3 日内最高/最低收益；
  - `max_dd_3d`：未来 3 日回撤；
  - `limit_up_flags`：未来几日是否出现涨停/连板（例如 `next_n_days_has_limit_up`）。

### 1.2 图任务（GNN）

- **目标**：在“概念/连板图”上，预测节点（个股）的相对强弱或接力概率。
- **标签**：
  - `gnn_target_score`：基于未来收益/连板情况构造的节点得分；
  - `gnn_edge_weight`：基于共振（日内联动/概念/高低位关系）构造的边权。

### 1.3 微观结构任务

- **目标**：检测盘口异常、假封单、砸盘前兆。
- **标签**：
  - `micro_anomaly_flag`：由 Microstructure Engine 输出的异常标注（例如 {0, 1}）；
  - `micro_order_imbalance_future`：未来若干分钟内主买/主卖失衡指标。

---

## 2. 因子族谱（简要版）

> 详尽的字段定义请参考“主战因子 & 标签 Datasheet”。

### 2.1 价格与波动因子

- `ret_xd`：多周期收益（1D / 3D / 5D 等）
- `volatility_xd`：波动率（Rolling σ）
- `gap_open`：当日开盘相对昨收的缺口大小

### 2.2 成交量与换手因子

- `volume_ratio_xd`：量能相对最近 X 日均值；
- `turnover_rate`：换手率及其分位数；
- `volume_spike`：成交激增程度。

### 2.3 订单流因子（Order Flow）

- `of_aggressive_buy_ratio`：主动买成交占比；
- `of_order_imbalance`：买卖盘不平衡度；
- `of_short_term_buy_pressure`：短周期内买盘压力指数；
- `of_fake_depth_score`：盘口“假单”评分（配合微观结构模块）。

### 2.4 概念/图特征因子（Concept & Graph）

- `concept_hotness`：题材热度；
- `concept_leader_score`：在概念图中的“龙头度”评分；
- `graph_pagerank`：图中 Pagerank 值；
- `graph_k_core`：核心层级。

### 2.5 情绪/舆情因子（Sentiment）

- `sentiment_score_forum`：论坛（如淘股吧）文本情绪；
- `sentiment_panic_index`：恐慌情绪指数；
- `sentiment_hype_index`：过热/“吹票”指数。

---

## 3. 模型家族（ModelZoo 简述）

### 3.1 基线模型

- 线性/逻辑回归、简单树模型（如 XGBoost/LightGBM 等）
  - 用途：快速验证因子方向性与标签是否合理；
  - 优点：易解释，调试方便；
  - 缺点：表达能力有限，难以抓住复杂非线性结构。

### 3.2 深度时序模型

- 如：TCN / LSTM / Transformer 等
  - 输入：单只股票 N 日时间窗口的因子序列；
  - 输出：未来一段时间内的得分/概率；
  - 适合：趋势/节奏类信号（例如打板后几日的博弈强度）。

### 3.3 图神经网络（GNN）

- 如：GCN / GraphSAGE / GAT 等
  - 输入：概念/连板图 + 节点因子；
  - 输出：节点得分（接力潜力、板块内部排序）；
  - 核心：利用“龙头带节奏”的板块传导特性，提前预判二三号位。

### 3.4 多任务模型

- 单一 backbone（例如深度时序 + 图），多个 head：
  - 一个 head 预测收益；
  - 一个 head 预测回撤风险；
  - 一个 head 判定“是否适合打板/半路”等。
- 优点：能在共享表示层中学习更稳健的特征。

---

## 4. 主战策略组合 U1/U2/U3（规则草稿）

> 以下为典型思路，具体细节在代码中可进一步精细化。

### 4.1 U1 – 情绪周期 · 隔日博弈

- **目标**：在题材情绪周期中，捕捉 **低位启动 / 首板 → 次日溢价** 的机会。
- **持股周期**：T+1 为主，特殊情况 T+2。
- **选股逻辑**：
  1. 当日涨停但非高度龙头，换手健康，成交量放大；
  2. 所在概念处于升温阶段，但情绪尚未极端过热；
  3. 订单流显示主动买盘优势明显，无明显假封单。
- **用到的因子/标签**：
  - 因子：量价、封单质量、情绪/舆情、订单流；
  - 标签：T+1 收益 `ret_1d`、T+3 最低回撤 `min_ret_3d`。
- **基本风控**：
  - 单票仓位限制（如 5%–10%）；
  - 次日若低开 + 大盘情绪转差，优先减仓/止盈。

### 4.2 U2 – 龙头接力 · 短线波段

- **目标**：在强趋势题材中跟随 **龙头/前排标的** 做 2–3 日波段。
- **持股周期**：2–4 日。
- **选股逻辑**：
  1. 所在概念在图谱中处于高核心度（Graph features）；
  2. 标的本身连板/放量突破，回调时资金承接良好（订单流不出现大幅主动卖出）；
  3. 舆情热度高但未极端 FOMO。
- **用到的因子/标签**：
  - 因子：图特征（leader_score, pagerank）、趋势/波动、订单流；
  - 标签：未来 3 日收益 `ret_3d`、最大回撤 `max_dd_3d`、连板标记。
- **基本风控**：
  - 设置最大持股天数、最大回撤；
  - 若 Microstructure Engine 检测到封单质量急剧变差，触发强平。

### 4.3 U3 – 微观结构 · 盘口博弈

- **目标**：在日内/超短周期里利用微观结构异常进行小波段或风险套保。
- **持股周期**：日内 ~ 1 日。
- **选股逻辑**：
  1. 在 L1 重构后的订单流中出现极端不平衡（如主买/主卖 > 阈值）；
  2. 假单/拉抬砸盘行为明显；
  3. 结合情绪/大盘环境，选择顺势/反向博弈。
- **用到的因子/标签**：
  - 因子：高频订单流指标、盘口压力、微观结构异常评分；
  - 标签：未来若干分钟/1 日内收益与回撤。
- **基本风控**：
  - 严格日内风控，绝不隔夜；
  - 作为补充策略，整体资金占比应较低。

---

## 5. 策略与系统模块的映射关系

- **DatasetBuilder**
  - 为 U1/U2/U3 各自定义数据集构建配置：
    - 输入因子集合（主战因子）；
    - 标签定义；
    - 样本过滤条件（ST/一字板等过滤）。
- **ModelZoo**
  - 为 U1/U2/U3 分别指定默认模型：
    - 例如：`model_id = "ultra_u1_tcn"`, `"ultra_u2_gnn"`, `"ultra_u3_micro"`。
- **TrainingPipelines**
  - 按 `(job_id, model_id, task_type)` 驱动训练；
  - 自动写入 ExperimentLab 记录。
- **PortfolioManager**
  - 在 `portfolio` 配置中，为不同策略分配资金权重/账户；
  - 管理整体仓位和风控上限。
- **Commander**
  - 订阅模型输出 `alpha.signal`；
  - 根据 `strategy_id` 把信号路由给不同策略逻辑；
  - 输出统一的 `trade.order` 事件。

---

## 6. 下一步可扩展方向（示意）

- 为每个策略建立 **专属 Walk‑Forward 配置**，定期验证鲁棒性；
- 引入 **元学习/策略选择器**：根据当前市场环境自动调整 U1/U2/U3 权重；
- 增加更多 **另类数据因子**（例如龙头董事访谈、公告文本等）；
- 对主战因子/模型进行周期性“施肥与除草”（定期删掉失效因子，引入新因子）。

> 建议：把这份文档当成“战术手册”，软件代码只是“武器”，而不是相反。
