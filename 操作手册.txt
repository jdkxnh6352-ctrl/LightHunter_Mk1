# LightHunter Mk3 — A 股超短线实验矩阵（科研操作手册）

> 版本：Mk3  
> 适用对象：你现在这套 LightHunter「奇点计划」工程，全流程（因子 → 模型 → 回测 → 绩效）科研用。:contentReference[oaicite:0]{index=0}  

---

## 0. 实验哲学：不要乱跑，只跑“有意义的组合”

我们的目标不是“把所有组合都跑一遍”，而是：

- **先锁定标签体系 + 主战因子 + 主战模型**  
- 再在此基础上有条理地做 **增量对比**：
  - 多/少某类因子；
  - 换一种模型家族；
  - 换样本区间 / 市场阶段；
  - 引入 GNN / 微观结构 / 情绪是否显著提升。

下面的实验矩阵，就按这个思路来设计。

---

## 1. 实验维度总览

我们把 A 股超短线实验拆成 6 个关键维度：

1. **任务 / 标签（Task & Label）**  
2. **因子集合（Factor Sets）**  
3. **模型族（Model Families）**  
4. **时间区间 + 切片（Sample Periods & Regimes）**  
5. **评估指标（Metrics）**  
6. **对照组（Baselines）**

每个实际实验可以抽象成一个“配置元组”：

> `Experiment = (Task, FactorSet, Model, Period, Regime, Metrics, Baseline)`

后面会给出命名规则和典型组合示例。

---

## 2. 任务 & 标签体系设计

### 2.1 主任务：超短主战标签（T+1 视角）

建议先把「主战标签」设计好，这是后续所有实验的主轴。

**主任务 T_main：隔日收益 / 连板战斗方向**

- **对象**：日频截面（所有可交易标的）
- **标签定义（示例）**：
  - `y_dir_1d`：  
    - +1：明日有显著超额收益（如 `ret_{t+1} - bench > +x%`）  
    -  0：中性  
    - -1：明显差于大盘（如 `< -x%`）
  - `y_ret_1d`：`(Close_{t+1} / Open_t - 1)` 或 `(Open_{t+1} / Open_t - 1)`  
  - `y_maxdd_3d`：未来 3 日最大回撤（用于风险或多任务头）

> 具体 x% 阈值你可以按历史分布选，比如 60/40 分位。

### 2.2 辅助任务：情绪 / 连板结构 / 微观任务

为了服务 U1/U2/U3 等不同打法，可以设计几个辅助任务：

- **T_lmt：连板 + 一字板相关标签**
  - `y_is_limitup_t`：当日是否涨停
  - `y_limitup_next`：明日是否涨停
  - `y_n_lmt_future_3d`：未来 3 日内连板数

- **T_emotion：情绪阶段标签**
  - `y_emotion_stage` ∈ {高潮, 分歧, 退潮, 冰点}  
  - 可由情绪因子（涨停家数、炸板率、跌停家数等）聚类 / 规则划分得到

- **T_micro：微观结构异常任务**
  - `y_micro_anomaly`：订单流/盘口是否存在“异常冲击”（例如巨量主动买盘后快速反杀）

> 这些辅助任务可以用于：
> - 直接训练策略（比如专门做“冰点反包”）
> - 或作为多任务模型的附加 head，提升主任务表达能力。

---

## 3. 因子集合设计（Factor Sets）

统一给因子集合起代号，方便组合：

### 3.1 基础价量因子（F_base）

- K 线类：涨跌幅、振幅、实体/上下影线比例  
- 波动率：N 日波动率、TrueRange 类指标  
- 成交量：量比、换手率、成交额、历史分位  
- 板块/指数 Beta：相对沪深 300、中证 500 的 Beta / 残差

> 作用：作为所有实验的“地基”。

### 3.2 超短结构因子（F_ultra）

针对 U1/U2/U3 的超短特化：

- 涨停相关：  
  - 距前一次涨停日数、最近 N 日涨停次数、炸板率  
  - 一字板/换手板特征（开盘是否一字、封单量、换手是否充分等）
- 情绪环境：  
  - 当日/近几日市场涨停家数、炸板率、跌停家数、情绪 Z-score  
- 板块地位：  
  - 是否“板块龙头”（同概念内换手/涨幅/成交额排名）

### 3.3 微观结构因子（F_micro）

利用你在奇点方案里提的 L1 差分 / 订单流重构：:contentReference[oaicite:1]{index=1}  

- 主动买卖盘（Aggressive buy / sell）估算  
- **Order Imbalance**：`(AggBuy - AggSell) / (AggBuy + AggSell)`  
- 买一/卖一队列的撤单率  
- 盘口压力：买盘/卖盘挂单量比、盘口偏移速度

### 3.4 概念图谱 & GNN 因子（F_graph）

- 来自 GNN 的节点嵌入 / 得分：
  - `gnn_score_alpha`：GNN 对某只票作为“题材龙头”的偏好  
  - `gnn_emb_*`：低维节点嵌入向量（可以做降维后拼到因子里）  
- 图结构特征：
  - 节点度数、介数中心性、PageRank、K-core 等

### 3.5 情绪 / 舆情因子（F_sentiment）

在舆情采集 + NLP 管线基础上：

- 舆情情绪分数：  
  - `sent_score_bull` / `sent_score_bear` / `sent_score_net`  
- 关注度因子：  
  - 帖子/评论量、增长率、热度排名  
- 文本模态：  
  - 高频词（核 / 地天 / 龙头 / 超预期 / 一字等）出现频率  

---

### 3.6 因子组合方案（实验用）

为方便搭配，定义几个标准组合：

- **FS1 = F_base**（纯价量基线）  
- **FS2 = F_base + F_ultra**（超短主战基础）  
- **FS3 = F_base + F_ultra + F_micro**（加入订单流/盘口）  
- **FS4 = F_base + F_ultra + F_sentiment**（加入情绪/舆情）  
- **FS5 = F_base + F_ultra + F_graph**（加入图谱/GNN）  
- **FS6 = F_base + F_ultra + F_micro + F_sentiment + F_graph**（全家桶）

---

## 4. 模型族设计（Model Families）

结合你现在的 ModelZoo（LR/MLP/GNN/多任务等），可以这样划分：

1. **M0 — 线性基线**  
   - Logistic Regression / Linear Regression  
   - 用于 sanity check：如果比不过 M0，说明因子或标签有问题。

2. **M1 — 小型 MLP（BaselineMLP）**  
   - 2 层 64/128 结构，训练/调参都很快  
   - 适合做快速实验筛选有潜力的因子组合。

3. **M2 — 超短主战 MLP（UltraMLP）**  
   - 3–4 层较宽结构（例如 512–256–128），带 BN + Dropout  
   - 主力模型，服务 T_main + U1/U2/U3。

4. **M3 — GNN 模型**  
   - GCN / GAT 等，用于概念图谱任务  
   - 可以单独做图任务（判断谁是龙/跟风），也可以输出嵌入给 MLP 用。

5. **M4 — 多任务 MLP（MTL）**  
   - 主干共享，多个 head：
     - head_alpha：回归未来收益  
     - head_risk：分类未来风险（低/中/高）  
     - head_limitup：预测连板/涨停概率

---

## 5. 时间区间 & 样本切片

### 5.1 基本切分：训练 / 验证 / 测试

建议采用**时间滚动切分**，而不是随机切分：

- **Train**：连续若干年，例如 3–4 年  
- **Valid**：紧随其后一段时间（半年~一年）  
- **Test**：更靠后的另一段时间（至少 1 年）

### 5.2 市场阶段切片（Regimes）

A 股超短高度依赖“情绪周期 + 市场环境”，建议在时间线上再做 regime 切片：

- R1：牛市 / 流动性宽松阶段  
- R2：震荡市 / 区间市  
- R3：熊市 / 流动性收紧 / 高监管阶段  
- R4：极端事件期（疫情、熔断等）

在实验矩阵里，你可以有：

- `Period_A`：全样本（例如 2017–2023）  
- `Period_B_R1`：只用牛市阶段样本  
- `Period_B_R3`：只用熊市阶段样本  

---

## 6. 评估指标体系

拆两层：**预测质量（pre-trade）** + **策略表现（post-trade）**。

### 6.1 预测质量（因子/模型本身）

对每个截面 t：

- **IC / RankIC**：
  - 预测值 vs 实际 `y_ret_1d` 的横截面相关系数  
  - 统计：
    - 均值（IC_mean）
    - 标准差（IC_vol）
    - ICIR（IC_mean / IC_vol）

- **分层收益**：
  - 按预测值分 `Q1..Q5` 五个组合  
  - 统计 Q5–Q1 的平均超额收益、胜率、t 值

- **分类相关指标（若是分类任务）**：
  - Accuracy / Precision / Recall / F1  
  - Top-K Precision（Top 1%/3% 的命中率）

### 6.2 策略表现（回测层）

利用你的 BacktestCore + PerformanceLab：

- 收益类：  
  - 年化收益（ret_ann）  
  - 总收益（ret_total）  

- 风险类：  
  - 年化波动（vol_ann）  
  - 最大回撤（max_dd）  
  - 最大回撤持续天数（max_dd_days）

- 性能比：  
  - 夏普比率（Sharpe）  
  - 卡玛比率（Calmar = ret_ann / |max_dd|）  

- 交易质量：  
  - 交易次数（bt_trades）  
  - 胜率（win_rate）  
  - 盈亏比（profit_factor）  
  - 平均持仓天数 / 换手率

---

## 7. 对照组（Baselines）

为了让结论有“参照系”，建议建立以下对照组：

1. **B0：随机选股 / 等权组合**
   - 每日随机选 N 只票等权持有，作为“纯噪声基线”。

2. **B1：价量因子 + 线性模型（FS1 + M0）**
   - 最朴素的 alpha 模型，用来衡量任何“复杂因子/模型”的真实增益。

3. **B2：价量因子 + 简单规则策略**
   - 例如“涨停打板 + 固定止损/止盈”这类传统超短玩法规则化版本。

4. **B3：只用 F_base + F_ultra，主战 MLP（FS2 + M2）**
   - 作为“主战 without 微观结构 / 情绪 / 图谱”的对照。

5. **B4：旧版本 LightHunter / 传统策略**
   - 如果你有早期版本的策略引擎，可以用作历史对照。

---

## 8. 实验命名规则 & 示例矩阵

### 8.1 命名规则

建议用一个统一的实验 ID 命名方式：

> `EXP-[Task]-[FactorSet]-[Model]-[Period]-[Regime]-v[版本号]`

例如：

- `EXP-Tmain-FS2-M2-P2018_2021-Rall-v1`
- `EXP-Tmain-FS3-M2-P2018_2021-Rall-v2`

### 8.2 核心实验矩阵示例（可作为第一批重点）

| 序号 | 实验 ID                                      | 任务    | 因子集         | 模型 | 区间 & Regime            | 对照组      | 目的                         |
|------|---------------------------------------------|---------|----------------|------|---------------------------|-------------|------------------------------|
| 1    | EXP-Tmain-FS1-M0-P2017_2020-Rall-v1         | T_main  | FS1 (价量)     | M0   | 2017–2020 全样本          | B0          | sanity check，验证标签 OK    |
| 2    | EXP-Tmain-FS2-M1-P2017_2020-Rall-v1         | T_main  | FS2 (价量+超短)| M1   | 2017–2020 全样本          | 1           | 检验超短结构因子是否有用     |
| 3    | EXP-Tmain-FS2-M2-P2017_2020-Rall-v1         | T_main  | FS2           | M2   | 同上                       | 2           | 主战 MLP 相对小 MLP 的提升   |
| 4    | EXP-Tmain-FS3-M2-P2017_2020-Rall-v1         | T_main  | FS3 (加微观)   | M2   | 同上                       | 3           | 订单流/盘口因子增量价值      |
| 5    | EXP-Tmain-FS4-M2-P2017_2020-Rall-v1         | T_main  | FS4 (加情绪)   | M2   | 同上                       | 3           | 情绪/舆情因子增量价值        |
| 6    | EXP-Tmain-FS6-M2-P2017_2020-Rall-v1         | T_main  | FS6 (全家桶)   | M2   | 同上                       | 4,5         | 全面融合的极限性能           |
| 7    | EXP-Tmicro-FS3-M2-P2017_2020-Rall-v1        | T_micro | FS3           | M2   | 同上                       | B3          | 纯微观结构任务效果           |
| 8    | EXP-Tgraph-FS_graph-M3-P2017_2020-Rall-v1   | T_graph | F_graph        | M3   | 同上                       | B2          | GNN 图谱对龙头识别的效果     |
| 9    | EXP-Tmain-FS2+GNN-M4-P2017_2020-Rall-v1     | T_main  | FS2 + F_graph | M4   | 同上                       | 6,8         | 多任务 (alpha+risk+graph) 效果 |

> 你可以先集中火力跑完 1–6，再视资源跑 7–9。

---

## 9. 建议执行顺序（实战操作步骤）

### Phase 1：标签 & 基线校准

1. 实现/确认标签计算逻辑（T_main、T_lmt、T_micro、T_emotion）。  
2. 跑 `EXP-Tmain-FS1-M0-*`（线性基线）：  
   - 看 IC / 回测收益能否明显优于随机。  
3. 跑 `EXP-Tmain-FS2-M1-*`：  
   - 确认超短结构因子明显优于纯价量。

### Phase 2：主战模型 & 因子增量

4. 以 `FS2 + M2` 作为主战组合：  
   - 调参 & 正则，跑几轮，把主战 baseline 站稳。  
5. 分别加入微观结构（FS3）、情绪（FS4）、图谱（FS5/FS6）：  
   - 每次只加一种或少数几种新品类因子，做增量对比。  

### Phase 3：多任务 / GNN / 微观任务

6. 跑 T_micro / T_graph 专用实验（类似 7/8 号实验）。  
7. 在主战 T_main 上引入多任务 M4：  
   - 同时预测收益 + 风险 + 连板，比较性能提升。

### Phase 4：市场阶段鲁棒性

8. 在不同 Regime（牛市 / 熊市 / 极端事件）的子样本上重复最优组合：  
   - 关注指标：IC 稳定性、策略收益的鲁棒性。  
9. 结合 RiskBrain，对高风险环境（高监管、高波动）做专门实验。

---

## 10. 你可以怎么用这份文档？

- 每次新开实验：  
  - 从上面的矩阵里挑一个组合，按命名规则写入 `ExperimentLab` 的 experiment_id；  
  - 在 `system_config` 或 `jobs` 里配置对应的 job；
  - 通过 NightOps / Scheduler 调用 `training_pipelines` + `backtest_core` 执行。

- 每完成一个阶段：  
  - 在 ExperimentLab / Dashboard 上总结：  
    - 哪类因子最有价值（微观、情绪、图谱…）  
    - 哪类模型最稳定（MLP / GNN / 多任务…）  
    - 哪些组合在不同市场环境下都能“打胜仗”。

---

> 如果你愿意，下一步我们可以做一件很实用的事：  
> 我帮你把上面这些实验组合，直接翻译成几份 **标准 job 配置模板**（写到 `system_config` 的 `jobs.training` / `jobs.backtest` 里），然后你就可以用 `job_id` 一键调用完整的“训练 + 回测 + 绩效记录”流水线。  
