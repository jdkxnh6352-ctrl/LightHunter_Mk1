{% extends "base.html" %}

{% block title %}LightHunter HUD - 实验 {{ exp_id }}{% endblock %}

{% block content %}
<div class="section">
  <h2>实验 {{ exp_id }}</h2>
  {% if not meta %}
  <p class="muted">未找到该实验的 meta 信息。</p>
  {% else %}
  <table>
    <tbody>
      <tr>
        <th style="width: 120px;">ID</th>
        <td class="mono">{{ meta.id }}</td>
      </tr>
      <tr>
        <th>Type</th>
        <td>{{ meta.type or meta.exp_type or "-" }}</td>
      </tr>
      <tr>
        <th>Status</th>
        <td>{{ meta.status or "-" }}</td>
      </tr>
      <tr>
        <th>Name</th>
        <td>{{ meta.name or "-" }}</td>
      </tr>
      <tr>
        <th>Start</th>
        <td class="mono small">{{ meta.start_time or "-" }}</td>
      </tr>
      <tr>
        <th>End</th>
        <td class="mono small">{{ meta.end_time or "-" }}</td>
      </tr>
      <tr>
        <th>Tags</th>
        <td>
          {% for t in meta.tags or [] %}
          <span class="tag">{{ t }}</span>
          {% endfor %}
        </td>
      </tr>
    </tbody>
  </table>
  {% endif %}
</div>

<div class="section">
  <h2>最近指标（metrics）</h2>
  {% if not metrics %}
  <p class="muted">暂无 metrics 记录。</p>
  {% else %}
  <table>
    <thead>
      <tr>
        <th>TS</th>
        <th>Step</th>
        <th>Keys</th>
      </tr>
    </thead>
    <tbody>
      {% for m in metrics %}
      <tr>
        <td class="small mono">{{ m.ts }}</td>
        <td class="mono">{{ m.step }}</td>
        <td class="small">
          {% set keys = (m.metrics or {}).keys() %}
          {{ keys | list | join(", ") }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>

<div class="section">
  <h2>最近事件（events）</h2>
  {% if not events %}
  <p class="muted">暂无 event 记录。</p>
  {% else %}
  <table>
    <thead>
      <tr>
        <th>TS</th>
        <th>Type</th>
        <th>Payload（截断展示）</th>
      </tr>
    </thead>
    <tbody>
      {% for e in events %}
      <tr>
        <td class="small mono">{{ e.ts }}</td>
        <td class="mono">{{ e.event_type }}</td>
        <td class="small mono">
          {% set payload = e.payload or {} %}
          {{ payload | tojson | truncate(120, True, '...') }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
{% endblock %}
